<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<title>Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¯Ù…Ù† Ø¬Ø¯ÙŠØ¯</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body{font-family:Tahoma,Arial;background:#f6f7fb;margin:0;padding:20px}
  .card{max-width:520px;margin:20px auto;background:#fff;border-radius:14px;padding:22px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
  h2{margin-top:0}
  label{display:block;margin:10px 0 6px}
  input,select{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px}
  button{margin-top:14px;padding:12px;border:0;border-radius:10px;background:#0070ba;color:#fff;cursor:pointer}
  .note{font-size:13px;color:#666}
  .ok{color:#1e7e34;margin-top:10px}
  .err{color:#c0392b;margin-top:10px}
</style>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

  // ===== Firebase Config (Ø®Ø§ØµØ© Ø¨Ù…Ø´Ø±ÙˆØ¹Ùƒ) =====
  const firebaseConfig = {
    apiKey: "AIzaSyBGFMZtSytIPzF4XYLyA34DpF5q_k-UPL8",
    authDomain: "fir-dba4c.firebaseapp.com",
    projectId: "fir-dba4c",
    storageBucket: "fir-dba4c.firebasestorage.app",
    messagingSenderId: "160255207915",
    appId: "1:160255207915:web:ce8e69d43f62daf476d1ae",
    measurementId: "G-GYPNMR85G2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø¬Ù‡ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  signInAnonymously(auth).catch(console.error);

  // Ø¯Ø§Ù„Ø© Ù‡Ø§Ø´ Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
  async function sha256(text){
    const enc = new TextEncoder().encode(text);
    const buf = await crypto.subtle.digest("SHA-256", enc);
    return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
  }

  async function createAdmin(){
    const username   = document.getElementById("username").value.trim();
    const name       = document.getElementById("name").value.trim();
    const password   = document.getElementById("password").value;
    const role       = document.getElementById("role").value;
    const secureKey  = document.getElementById("secureKey").value;

    const msg = document.getElementById("msg");
    msg.textContent = ""; msg.className = "";

    if(!username || !name || !password || !secureKey){
      msg.textContent = "Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„."; msg.className="err"; return;
    }

    try{
      const passwordHash = await sha256(password);

      // Ø¨Ù†ÙƒØªØ¨ doc Ø§Ø³Ù…Ù‡ = username
      await setDoc(doc(db,"admins",username),{
        username,
        name,
        role,                 // "admin" | "superadmin"
        passwordHash,         // Ù…Ø´ Ø¨Ù†Ø®Ø²Ù‘Ù† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù†ÙØ³Ù‡
        secureKey,            // ğŸ”´ Ù…Ø¤Ù‚ØªÙ‹Ø§ Ø¹Ø´Ø§Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© ØªØ³Ù…Ø­ Ø¨Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
        createdAt: serverTimestamp()
      });

      msg.textContent = "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø¯Ù…Ù† Ø¨Ù†Ø¬Ø§Ø­ âœ… (Ù„Ø§ ØªÙ†Ø³Ù Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯).";
      msg.className = "ok";
    }catch(e){
      console.error(e);
      msg.textContent = "Ø®Ø·Ø£: " + (e?.message || e); 
      msg.className = "err";
    }
  }

  window.createAdmin = createAdmin;
</script>
</head>
<body>
  <div class="card">
    <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø£Ø¯Ù…ÙÙ† Ø¬Ø¯ÙŠØ¯ ğŸ“Œ</h2>

    <label>Ø§Ø³Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ (username):</label>
    <input id="username" placeholder="Ù…Ø«Ø§Ù„: ali2020" />

    <label>Ø§Ù„Ø§Ø³Ù…:</label>
    <input id="name" placeholder="Ù…Ø«Ø§Ù„: Ali Elsayed" />

    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
    <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />

    <label>Ø§Ù„Ø¯ÙˆØ± (role):</label>
    <select id="role">
      <option value="superadmin">Super Admin</option>
      <option value="admin">Admin</option>
    </select>

    <label>Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ù…Ù†ÙŠ (Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø¥Ù†Ø´Ø§Ø¡):</label>
    <input id="secureKey" type="password" placeholder="Ali2845294@" />

    <button onclick="createAdmin()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯Ù…Ù†</button>
    <div class="note">Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ÙˆÙ„ ÙÙ‚Ø·. Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ø£Ø¯Ù…Ù†ØŒ ÙŠÙÙØ¶Ù‘Ù„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯.</div>
    <div id="msg"></div>
  </div>
</body>
</html>
