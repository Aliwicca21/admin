<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<title>إنشاء أدمن جديد</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body{font-family:Tahoma,Arial;background:#f6f7fb;margin:0;padding:20px}
  .card{max-width:520px;margin:20px auto;background:#fff;border-radius:14px;padding:22px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
  h2{margin-top:0}
  label{display:block;margin:10px 0 6px}
  input,select{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px}
  button{margin-top:14px;padding:12px;border:0;border-radius:10px;background:#0070ba;color:#fff;cursor:pointer}
  .note{font-size:13px;color:#666}
  .ok{color:#1e7e34;margin-top:10px}
  .err{color:#c0392b;margin-top:10px}
</style>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

  // ===== Firebase Config (خاصة بمشروعك) =====
  const firebaseConfig = {
    apiKey: "AIzaSyBGFMZtSytIPzF4XYLyA34DpF5q_k-UPL8",
    authDomain: "fir-dba4c.firebaseapp.com",
    projectId: "fir-dba4c",
    storageBucket: "fir-dba4c.firebasestorage.app",
    messagingSenderId: "160255207915",
    appId: "1:160255207915:web:ce8e69d43f62daf476d1ae",
    measurementId: "G-GYPNMR85G2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  // تسجيل دخول مجهول تلقائيًا
  signInAnonymously(auth).catch(console.error);

  // دالة هاش لكلمة المرور
  async function sha256(text){
    const enc = new TextEncoder().encode(text);
    const buf = await crypto.subtle.digest("SHA-256", enc);
    return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
  }

  async function createAdmin(){
    const username   = document.getElementById("username").value.trim();
    const name       = document.getElementById("name").value.trim();
    const password   = document.getElementById("password").value;
    const role       = document.getElementById("role").value;
    const secureKey  = document.getElementById("secureKey").value;

    const msg = document.getElementById("msg");
    msg.textContent = ""; msg.className = "";

    if(!username || !name || !password || !secureKey){
      msg.textContent = "رجاءً املأ كل الحقول."; msg.className="err"; return;
    }

    try{
      const passwordHash = await sha256(password);

      // بنكتب doc اسمه = username
      await setDoc(doc(db,"admins",username),{
        username,
        name,
        role,                 // "admin" | "superadmin"
        passwordHash,         // مش بنخزّن الباسورد نفسه
        secureKey,            // 🔴 مؤقتًا عشان القاعدة تسمح بالإنشاء
        createdAt: serverTimestamp()
      });

      msg.textContent = "تم إنشاء الأدمن بنجاح ✅ (لا تنسَ لاحقًا إغلاق الإنشاء من القواعد).";
      msg.className = "ok";
    }catch(e){
      console.error(e);
      msg.textContent = "خطأ: " + (e?.message || e); 
      msg.className = "err";
    }
  }

  window.createAdmin = createAdmin;
</script>
</head>
<body>
  <div class="card">
    <h2>إنشاء حساب أدمِن جديد 📌</h2>

    <label>اسم الدخول (username):</label>
    <input id="username" placeholder="مثال: ali2020" />

    <label>الاسم:</label>
    <input id="name" placeholder="مثال: Ali Elsayed" />

    <label>كلمة المرور:</label>
    <input id="password" type="password" placeholder="••••••••" />

    <label>الدور (role):</label>
    <select id="role">
      <option value="superadmin">Super Admin</option>
      <option value="admin">Admin</option>
    </select>

    <label>الباسورد الأمني (مطلوب للإنشاء):</label>
    <input id="secureKey" type="password" placeholder="Ali2845294@" />

    <button onclick="createAdmin()">إضافة الأدمن</button>
    <div class="note">هذه الصفحة للإنشاء الأول فقط. بعد إنشاء أول أدمن، يُفضّل إغلاق الإنشاء من القواعد.</div>
    <div id="msg"></div>
  </div>
</body>
</html>
